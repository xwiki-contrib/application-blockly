<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version="1.3" reference="Blockly.WebHome" locale="">
  <web>Blockly</web>
  <name>WebHome</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1526896026000</creationDate>
  <parent>Main.WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1526896422000</date>
  <contentUpdateDate>1527518492000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content/>
  <object>
    <name>Blockly.WebHome</name>
    <number>0</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>781eaa7e-2fcc-45ea-ad42-14008dbb1caf</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>default</cache>
    </property>
    <property>
      <code>require.config({
  paths: {
    'blockly-comp': '$services.webjars.url("blockly", "blockly_compressed.js")',
    'blocks-comp': '$services.webjars.url("blockly", "blocks_compressed.js")',
    'js-comp': '$services.webjars.url("blockly", "javascript_compressed.js")',
    'media': '#removeJsSuffix($services.webjars.url("blockly", "media/"))',
    'jquery': '$services.webjars.url("jquery", "jquery.js")',
    'blockly-msg-en': '$services.webjars.url("blockly", "msg/js/en.js")'
  },
  shim: {
    'blocks-comp': ['blockly-comp'],
    'blockly-msg-en': ['blockly-comp'],
    'js-comp': ['blockly-comp']
  }
});


require(['blockly-comp', 'blocks-comp', 'blockly-msg-en', 'js-comp', 'jquery', 'media'], function(blockly, blocks, msg, js, $, media) {
  var demoWorkspace = Blockly.inject('blocklyDiv',
  {media: media,
  toolbox: document.getElementById('toolbox')});

  $('#show').click(function(e) {
    Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
    var code = Blockly.JavaScript.workspaceToCode(demoWorkspace), element = $('#content');
    e.preventDefault();
    var caretPos = element[0].selectionStart, currentValue = element.val();
    element.val(currentValue.substring(0, caretPos) + code + currentValue.substring(caretPos));
  });

  $('#run').click(function() {
    window.LoopTrap = 1000;
    Blockly.JavaScript.INFINITE_LOOP_TRAP =
      'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
    var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
    Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
    try {
      eval(code);
    } catch (e) {
      alert(e);
    }
  });
});
</code>
    </property>
    <property>
      <name>Blockly Editor</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>Blockly.WebHome</name>
    <number>1</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>efd60752-e656-43ce-9e45-a6a71fcc2864</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>default</cache>
    </property>
    <property>
      <code>var XWiki=(function(d){var c=d.actionButtons=d.actionButtons||{};c.EditActions=Class.create({initialize:function(){this.addListeners();this.addShortcuts();this.addValidators()},addListeners:function(){$$("input[name=action_cancel]").each(function(e){e.observe("click",this.onCancel.bindAsEventListener(this))}.bind(this));$$("input[name=action_preview]").each(function(e){e.observe("click",this.onSubmit.bindAsEventListener(this,"preview"))}.bind(this));$$("input[name=action_save]").each(function(e){e.observe("click",this.onSubmit.bindAsEventListener(this,"save"))}.bind(this));$$("input[name=action_saveandcontinue]").each(function(e){e.observe("click",this.onSubmit.bindAsEventListener(this,"save",true))}.bind(this))},addShortcuts:function(){var e={action_cancel:"$services.localization.render('core.shortcuts.edit.cancel')",action_preview:"$services.localization.render('core.shortcuts.edit.preview')",action_edit:"$services.localization.render('core.shortcuts.edit.backtoedit')",action_inline:"$services.localization.render('core.shortcuts.edit.backtoedit')",action_save:"$services.localization.render('core.shortcuts.edit.saveandview')",action_propupdate:"$services.localization.render('core.shortcuts.edit.saveandview')",action_saveandcontinue:"$services.localization.render('core.shortcuts.edit.saveandcontinue')"};for(var f in e){var g=$$("input[name="+f+"]");if(g.size()&gt;0){shortcut.add(e[f],function(){this.click()}.bind(g.first()))}}},validators:new Array(),addValidators:function(){var e=$("body").select("input.required");for(var h=0;h&lt;e.length;h++){var f=e[h];var g=new LiveValidation(f,{validMessage:""});g.add(Validate.Presence,{failureMessage:"$services.localization.render('core.validation.required.message')"});g.validate();this.validators.push(g)}},validateForm:function(g){for(var f=0;f&lt;this.validators.length;f++){if(!this.validators[f].validate()){return false}}var h=g.comment;if(h&amp;&amp;($xwiki.isEditCommentSuggested()||$xwiki.isEditCommentMandatory())){while(h.value==""){var e=prompt("$services.localization.render('core.comment.prompt')","");if(e===null){return false}h.value=e;if(!$xwiki.isEditCommentMandatory()){break}}}return true},onCancel:function(g){g.stop();this.notify(g,"cancel");var f=g.element().form.action;if(typeof f!="string"){f=g.element().form.attributes.getNamedItem("action");if(f){f=f.nodeValue}else{f=window.self.location.href}}var i=f.split("#",2);var k=(i.length==2)?i[1]:"";f=i[0];if(f.indexOf("?")==-1){f+="?"}var j="&amp;action_cancel=true";var h=g.element().form.select('input[name="xredirect"]')[0];var e=h?"&amp;xredirect="+escape(h.value):"";d.EditLock&amp;&amp;d.EditLock.setLocked(false);window.location=f+j+e+k},onSubmit:function(g,h,f){var e="before"+h.substr(0,1).toUpperCase()+h.substr(1);if(this.notify(g,e,{"continue":f})){if(this.validateForm(g.element().form)){this.notify(g,h,{"continue":f})}else{g.stop()}}},notify:function(e,f,g){document.fire("xwiki:actions:"+f,Object.extend({originalEvent:e,form:e.element().form},g||{}));if(e.stopped){e.stop()}return !e.stopped}});c.AjaxSaveAndContinue=Class.create({initialize:function(){this.createMessages();this.addListeners()},createMessages:function(){this.savingBox=new d.widgets.Notification("$escapetool.javascript($services.localization.render('core.editors.saveandcontinue.notification.inprogress'))","inprogress",{inactive:true});this.savedBox=new d.widgets.Notification("$escapetool.javascript($services.localization.render('core.editors.saveandcontinue.notification.done'))","done",{inactive:true});this.failedBox=new d.widgets.Notification('$escapetool.javascript($services.localization.render("core.editors.saveandcontinue.notification.error", ["&lt;span id=""ajaxRequestFailureReason""/&gt;"]))',"error",{inactive:true});this.progressMessageTemplate="$escapetool.javascript($services.localization.render('core.editors.savewithprogress.notification'))";this.progressBox=new d.widgets.Notification(this.progressMessageTemplate.replace("__PROGRESS__","0"),"inprogress",{inactive:true})},addListeners:function(){document.observe("xwiki:actions:save",this.onSave.bindAsEventListener(this))},onSave:function(h){if(h.stopped){return}var k=h.memo["continue"];this.form=$(h.memo.form);this.savedBox.hide();this.failedBox.hide();var e=(this.form.template&amp;&amp;this.form.template.value);if(!e&amp;&amp;(!k||$("body").hasClassName("previewbody"))){return}var g=(this.form.action.indexOf("/preview/")==-1);var i=(this.form.async&amp;&amp;this.form.async.value==="true");if(!i||g){if(!k){return}e=false}if(typeof(h.memo.originalEvent)!="undefined"){h.memo.originalEvent.stop()}if(e){this.progressBox.show()}else{if(k){this.savingBox.show()}}var f="action_save";if(k){f="action_saveandcontinue"}var j=new Hash(this.form.serialize({hash:true,submit:f}));if(k){j.set("minorEdit","1")}if(!Prototype.Browser.Opera){j.set("ajax","true")}new Ajax.Request(this.form.action,{method:"post",parameters:j.toQueryString(),onSuccess:this.onSuccess.bindAsEventListener(this,k,e),on1223:this.on1223.bindAsEventListener(this),on0:this.on0.bindAsEventListener(this),onFailure:this.onFailure.bind(this)})},on1223:function(e){e.request.options.onSuccess(e)},on0:function(e){e.request.options.onFailure(e)},onSuccess:function(f,g,e){if(this.form&amp;&amp;this.form.template){this.form.template.disabled=true;this.form.template.value=""}if(e){if(!g){this.form.disable()}this.getStatus(f.responseJSON.links[0].href,g)}else{if(g){this.savingBox.replace(this.savedBox)}}document.fire("xwiki:document:saved")},onFailure:function(e){this.savingBox.replace(this.failedBox);this.progressBox.replace(this.failedBox);if(e.statusText==""||e.status==12031){$("ajaxRequestFailureReason").update("Server not responding")}else{if(e.getHeader("Content-Type").match(/^\s*text\/plain/)){$("ajaxRequestFailureReason").update(e.responseText)}else{$("ajaxRequestFailureReason").update(e.statusText)}}document.fire("xwiki:document:saveFailed",{response:e})},startStatusReport:function(e){updateStatus(0)},getStatus:function(g,f,e){new Ajax.Request(g,{method:"get",parameters:{media:"json"},onSuccess:function(i){var h=i.responseJSON.progress.offset;this.updateStatus(h);if(h&lt;1){setTimeout(this.getStatus.bind(this,g,f),1000)}else{this.progressBox.replace(this.savedBox);this.maybeRedirect(f)}}.bindAsEventListener(this),on1223:this.on1223.bindAsEventListener(this),on0:this.on0.bindAsEventListener(this),onFailure:this.onFailure.bindAsEventListener(this)})},updateStatus:function(e){var g=""+(e*100);var f=g.indexOf(".");if(f&gt;-1){var g=g.substring(0,f+2)}var h=new d.widgets.Notification(this.progressMessageTemplate.replace("__PROGRESS__",g),"inprogress");this.progressBox.replace(h);this.progressBox=h},maybeRedirect:function(g){var e="";if(!g){e=d.currentDocument.getURL();var f=this.form.select('input[name="xredirect"]')[0];if(f&amp;&amp;f.value){e=f.value}}else{if($("body").hasClassName("previewbody")){e=d.currentDocument.getURL("edit");if(this.form.xcontinue&amp;&amp;this.form.xcontinue.value){e=this.form.xcontinue.value}}else{return}}if(e){window.location=e}}});function b(){new c.EditActions();new c.AjaxSaveAndContinue();return true}(d.domIsLoaded&amp;&amp;b())||document.observe("xwiki:dom:loaded",b);function a(){if(typeof(Wysiwyg)=="undefined"){return}var h=Wysiwyg.getInstances();for(var f in h){var g=h[f];var e=g.getPlainTextArea();if(e&amp;&amp;!e.disabled){$(f).value=e.value}else{g.getCommandManager().execute("submit")}}}document.observe("xwiki:actions:save",a);document.observe("xwiki:actions:preview",a);return d}(XWiki||{}));</code>
    </property>
    <property>
      <name>ActionButtons</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>Blockly.WebHome</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>63a6488a-5ec9-4646-b0e3-7a57d0fbec41</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>6</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>default</cache>
    </property>
    <property>
      <code>#template('colorThemeInit.vm') .meta-versionSummary label{color:$theme.textSecondaryColor;font-size:.85em;font-weight:700;margin:10px 0 4px!important;text-align:left!important;text-transform:uppercase}.skin-colibri .meta-versionSummary label{display:block}.meta-versionSummary span{text-transform:none;font-weight:400}.meta-minorEdit{float:right}.meta-minorEdit label{margin:0!important}.meta-minorEdit *{vertical-align:text-bottom}#commentinput{width:99.7%}</code>
    </property>
    <property>
      <contentType>CSS</contentType>
    </property>
    <property>
      <name>Action Buttons css</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>Blockly.WebHome</name>
    <number>0</number>
    <className>XWiki.UIExtensionClass</className>
    <guid>0f52d439-a893-490a-bc73-7f51d8fa7205</guid>
    <class>
      <name>XWiki.UIExtensionClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <content>
        <disabled>0</disabled>
        <editor>Text</editor>
        <name>content</name>
        <number>3</number>
        <prettyName>Extension Content</prettyName>
        <rows>10</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </content>
      <extensionPointId>
        <disabled>0</disabled>
        <name>extensionPointId</name>
        <number>1</number>
        <prettyName>Extension Point ID</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </extensionPointId>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Extension ID</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parameters>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>parameters</name>
        <number>4</number>
        <prettyName>Extension Parameters</prettyName>
        <rows>10</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </parameters>
      <scope>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>scope</name>
        <number>5</number>
        <prettyName>Extension Scope</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>wiki=Current Wiki|user=Current User|global=Global</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </scope>
    </class>
    <property>
      <content>{{velocity}}{{html clean="false"}} ## we need clean="false" because we want to display the raw content of #submenuitem()
 #template('menus_macros.vm')
#set($url = $xwiki.getURL('Blockly.Editor'))
#set($param = "?docRef=$doc.documentReference")
#set($finalURL = "${url}${param}")
#submenuitem($finalURL, 'Blockly', 'blockly.editactions', '', 'bricks')
{{/html}}{{/velocity}}</content>
    </property>
    <property>
      <extensionPointId>org.xwiki.plaftorm.editactions</extensionPointId>
    </property>
    <property>
      <name>blockly.editactions</name>
    </property>
    <property>
      <parameters>order=35000</parameters>
    </property>
    <property>
      <scope>wiki</scope>
    </property>
  </object>
</xwikidoc>
